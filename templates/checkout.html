{% extends "base.html" %}

{% block content %}
<div class="container">
    <div style="max-width: 800px; margin: 0 auto;">
        <h1 style="text-align: center; margin-bottom: 2rem;">Complete Your Adoption</h1>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
            <!-- Order Summary -->
            <div>
                <div class="form-container">
                    <h3>Order Summary</h3>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="dog-image" style="width: 100px; height: 100px; border-radius: 8px; overflow: hidden;">
                            {% if dog.image_url %}
                            <img src="{{ dog.image_url }}" alt="{{ dog.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                            {% else %}
                            <div style="width: 100%; height: 100%; background: var(--secondary-color); display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 2rem;">üêï</span>
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <h4 style="margin-bottom: 0.5rem;">{{ dog.name }}</h4>
                            <p style="color: #666; margin-bottom: 0.5rem;">{{ dog.breed }}</p>
                            <p style="color: #666;">{{ dog.age }} year{{ 's' if dog.age != 1 }} old ‚Ä¢ {{ dog.size }}</p>
                        </div>
                    </div>
                    
                    <div class="payment-summary">
                        <div class="summary-item">
                            <span>Dog Price:</span>
                            <span>KES {{ "{:,.0f}".format(dog.price) }}</span>
                        </div>
                        <div class="summary-item">
                            <span>Delivery Fee:</span>
                            <span>KES 0</span>
                        </div>
                        <div class="summary-item">
                            <span>Tax:</span>
                            <span>KES 0</span>
                        </div>
                        <div class="summary-item" style="border-bottom: none; font-weight: bold;">
                            <span>Total Amount:</span>
                            <span>KES {{ "{:,.0f}".format(dog.price) }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Adoption Information -->
                <div class="form-container" style="margin-top: 1.5rem;">
                    <h3>Adoption Process</h3>
                    <ol style="padding-left: 1.5rem; line-height: 1.6;">
                        <li>Complete M-Pesa payment</li>
                        <li>Receive payment confirmation</li>
                        <li>Schedule pickup/delivery</li>
                        <li>Sign adoption agreement</li>
                        <li>Welcome your new companion!</li>
                    </ol>
                </div>
            </div>
            
            <!-- Payment Form -->
            <div>
                <div class="form-container">
                    <h3>Payment Details</h3>
                    
                    <div class="mpesa-note">
                        <p>üí° <strong>M-Pesa Payment Instructions:</strong></p>
                        <p>1. Enter your M-Pesa registered phone number</p>
                        <p>2. Click "Pay with M-Pesa"</p>
                        <p>3. Check your phone for STK push prompt</p>
                        <p>4. Enter your M-Pesa PIN to complete payment</p>
                    </div>
                    
                    <form id="payment-form" method="POST">
                        <input type="hidden" name="dog_id" value="{{ dog.id }}">
                        <input type="hidden" name="amount" value="{{ dog.price }}">
                        <input type="hidden" name="email" value="{{ current_user.email }}">
                        <input type="hidden" name="first_name" value="{{ current_user.first_name }}">
                        <input type="hidden" name="last_name" value="{{ current_user.last_name }}">
                        
                        <div class="form-group">
                            <label for="mpesa_number">M-Pesa Phone Number</label>
                            <input type="tel" id="mpesa_number" name="mpesa_number" 
                                   placeholder="254712345678" required 
                                   pattern="254[17]\d{8}" 
                                   title="Enter a valid Kenyan phone number starting with 254"
                                   value="{{ current_user.phone }}">
                            <small style="color: #666;">Format: 254712345678</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="delivery_address">Delivery Address (Optional)</label>
                            <textarea id="delivery_address" name="delivery_address" 
                                      rows="3" placeholder="Enter your address for delivery arrangements..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="special_instructions">Special Instructions (Optional)</label>
                            <textarea id="special_instructions" name="special_instructions" 
                                      rows="2" placeholder="Any special requirements or notes..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn" style="width: 100%; font-size: 1.1rem; padding: 15px;">
                            Pay with M-Pesa - KES {{ "{:,.0f}".format(dog.price) }}
                        </button>
                    </form>
                </div>
                
                <!-- Contact Information -->
                <div class="form-container" style="margin-top: 1.5rem; text-align: center;">
                    <h4>Need Help?</h4>
                    <p>Contact our adoption team:</p>
                    <p>üìû <strong>+254 700 000000</strong></p>
                    <p>‚úâÔ∏è <strong>adoptions@woofcare.com</strong></p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/payments.js') }}"></script>
{% endblock %}